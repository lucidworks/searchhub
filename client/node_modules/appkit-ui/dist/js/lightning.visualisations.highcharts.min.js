/*! appkit-ui 2018-06-22 */
!function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge","?^^graphFlow"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h={enabled:!0,text:c.text,href:c.href};null!=e?e.addCreditOptions(h):null!=f?f.addCreditOptions(h):null!=g&&g.addCreditOptions(h)}}};return a}angular.module("lightning").directive("chartCredit",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",scope:{response:"@",results:"=?",options:"=?",ytitle:"@",xtitle:"@"},transclude:!0,controller:["$scope","$attrs","$filter","$timeout","$element","$window","TranslationService",function(f,g,h,i,j,k,l){function m(){angular.element(k).off("resize",n)}function n(){null!=f.seriesCopy&&i(function(){var a=angular.element(j[0].querySelector("#field-name")).text(),b=angular.element(j[0].querySelector("#count")).text();angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var c=f.seriesCopy,d=c.chart.renderer,e=c.chart.plotLeft+c.center[0],g=c.chart.plotTop+c.center[1];d.text(a,e,g).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),d.text(b,e,g+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),a.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):a.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):a.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):a.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):a.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):a.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):a.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")},0)}function o(){f.showApplyFilters=!1,f.allSeries=[],f.fields=[],f.chartConfig.series=[],f.timeSeriesFacets=[],"time"!=g.type&&(f.chartConfig.xAxis.categories=[]),f.actCategories=[],f.singleFilterOverlay=!1,L=[],f.loading=0,f.query=d.getQueryAsHttpParams(g.query,!0)}function p(){f.chartConfig&&"function"==typeof f.chartConfig.getChartObj&&i(function(){f.chartConfig.getChartObj().reflow()},0)}function q(a){if(f.chartConfig&&f.chartConfig.series){var b;a.tkid=a.name+"-"+a.title+"-"+a.type,a.id=_.kebabCase(a.tkid),a._colorIndex=f.chartConfig.series.length%10,"true"==g.selectSeries?(f.allSeries.push(a),f.unselectedSeries.indexOf(a.tkid)!=-1||a.hasOwnProperty("selected")&&1!=a.selected||(f.chartConfig.series.push(a),b=angular.copy(f.chartConfig),f.chartConfig=null,f.chartConfig=b)):(f.chartConfig.series.push(a),b=angular.copy(f.chartConfig),f.chartConfig=null,f.chartConfig=b)}angular.merge(f.chartConfig,f.options),p()}function r(a,b){0==f.chartConfig.series.length&&f.chartConfig.foo++;var c=null;"false"!=b.showMarker&&"true"!=b.showMarker||(c={enabled:"true"==b.showMarker}),f.fields.push(b.valueField);var e=t(b.name,b.type,b.tooltipOptions,c,b.select);e.title=b.title||e.name,e.selected=b.selected,b.field=b.field||b.name;var i=a.header.indexOf(b.labelField),j=a.header.indexOf(b.valueField),k=a.header.indexOf(b.urlField),l=a.header.indexOf(b.classField);if(angular.forEach(a.series,function(a){if(!isNaN(a[j])){var c,g=a[j],m=parseFloat(a[j]),n=a[i],o=null!=n.act?n.act:null!=n.dsp?n.dsp:n,p=null!=n.dsp?n.dsp:n,q=null;k!=-1&&(c=a[k]),l!=-1&&(q=h("display")(a[l]),null!=q&&(q=h("formatAsCssName")(q))),null!=b.dateFormat&&("undefined"!=typeof p.indexOf?0==p.indexOf("<")?(p=p.substring(1),p=h("dateFormat")(p.trim(),b.dateFormat),p="&lt; "+p):0==p.indexOf(">")?(p=p.substring(1),p=h("dateFormat")(p.trim(),b.dateFormat),p="&gt; "+p):p=h("dateFormat")(p,b.dateFormat):p=h("dateFormat")(p,b.dateFormat));var r=!1;if(b.query){var s=d.convertHttpParamsToQuery(b.query),t={field:b.field,val:"result-list"==b.dataType?g:o,optional:"value"};r=d.queryContainsFilterForField(s,t.field,t)}var u={name:p,y:m,className:q,selected:r,sliced:r};if("result-list"==b.dataType?u.filter=[b.field,g,g,b.action]:"pivot-facet"==b.dataType?u.filter=[b.field,b.name,b.name,b.action]:u.filter=[b.field,o,p,b.action],I(f.actCategories,o)!=-1)e.data[I(f.actCategories,o)]=u,null!=c?e.urls[I(f.actCategories,o)]=c:null!=b.query&&(e.filters[I(f.actCategories,o)]=u.filter);else{f.chartConfig.xAxis.categories.push(p),f.actCategories.push(o),e.data.push(u);var v;null!=c?(v=e.data.length>0?e.data.length-1:0,e.urls[v]=c):null!=b.query&&(v=e.data.length>0?e.data.length-1:0,e.filters[v]=u.filter)}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,q(e),H(),null!=b.query&&g.hasOwnProperty("singleFilterMode")){var m=d.convertHttpParamsToQuery(b.query);if(m.filters)for(var n=0;n<m.filters.length;n++)b.field==m.filters[n].field&&1==e.data.length&&C(b.field,e.data[0].name,e.data[0].y)}}function s(a,b){0==f.chartConfig.series.length&&f.chartConfig.foo++,f.timeSeriesFacets.indexOf(b.name)==-1&&f.timeSeriesFacets.push(b.name),0!=f.chartConfig.rangeSelector.enabled&&null!=b.rangeSelector&&(f.chartConfig.rangeSelector.enabled=b.rangeSelector),0!=f.chartConfig.navigator.enabled&&null!=b.navigator&&(f.chartConfig.navigator.enabled=b.navigator),null!=b.query&&(M=!0),b.title=null==b.title?l.get(b.name):b.title;var c={name:b.title,data:[],tooltip:b.tooltipOptions,type:b.type,showInNavigator:!0,selected:b.selected};void 0!=b.markerOptions&&null!=b.markerOptions&&(c.marker=b.markerOptions);var d=[],e=a.header.indexOf(b.labelField),g=a.header.indexOf(b.valueField);angular.forEach(a.series,function(a){if(!isNaN(a[g])){var b;b=null!=a[e].act?null!=a[e].act.from?a[e].act.from:null!=a[e].act.to?a[e].act.to:a[e].act:a[e],d.push({act:new Date(b).valueOf(),count:a[g]})}}),"true"!=b.sort&&null!=b.sort||(d=h("orderBy")(d,"act")),angular.forEach(d,function(a){c.data.push([new Date(a.act).valueOf(),a.count])}),q(c),H(),p()}function t(c,d,e,i,k){d=null==d?g.type:d,"donut"==d&&(d="pie",null==f.chartConfig.plotOptions.pie.innerSize&&(f.chartConfig.plotOptions.pie.innerSize="50%"));var m={className:"highcharts-series-"+h("formatAsCssName")(c),name:l.get(c),data:[],type:d,urls:[],filters:[],events:{click:function(c){var d=c.point.index;if(null!=this.userOptions.urls[d])document.location=this.userOptions.urls[d];else if(this.userOptions.multiselect&&this.userOptions.filters[d])if("instant"==this.userOptions.multiselect){var e=this.userOptions.filters[d];c.point.selected?a.removeFilterValueFromUrl(e[0],e[1],!0):a.addFilterToUrl(e[0],e[1],e[2],!0,"value")}else f.showApplyFilters=!0,c.point.select(null,!0);else if(null!=this.userOptions.filters[d]){var g=this.userOptions.filters[d];null!=g[3]&&b.path(g[3]);var h=g[1];null!=this.userOptions.query&&a.setUrlParameters(this.userOptions.query,!1),void 0!=h&&"range"==h.type?a.addRangeFilterDisplayToUrl(g[0],h.from,h.to,g[2],!0,!1,h.fromExcluded,h.toExcluded):a.addFilterToUrl(g[0],g[1],g[2],!0)}}},tooltip:e};return"pie"==d&&null!=g.innerSize&&"true"==g.showValue&&(m.point={events:{mouseOver:function(){f.seriesCopy=this.series,angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var a=this.series,b=this.series.chart.renderer,c=this.series.chart.plotLeft+a.center[0],d=this.series.chart.plotTop+a.center[1];b.text(this.name,c,d).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),b.text(h("numberFormat")(this.y,"formatted"),c,d+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),angular.forEach(this.series.points,function(a){a.slice(!1)}),this.slice(!0),this.name.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):this.name.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):this.name.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):this.name.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):this.name.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):this.name.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):this.name.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")}}}),void 0!=i&&null!=i&&(m.marker=i),0==f.chartConfig.series.length&&void 0==f.chartConfig.legend?f.chartConfig.legend={enabled:!1}:void 0==f.chartConfig.legend&&(f.chartConfig.legend={enabled:!0}),null!=g.stacking&&(m.stacking=g.stacking),"pie"!=d&&(m.dataLabels={enabled:"true"==g.showDataLabels,style:{}}),"bar"==d&&(f.chartConfig.chart.inverted=!0),"multiselect"==k?m.multiselect=!0:"multiselect-instant"==k?m.multiselect="instant":"multiselect"==g.select&&"false"!=k?m.multiselect=!0:"multiselect-instant"==g.select&&"false"!=k&&(m.multiselect="instant"),u(d),m.data=Array.apply(null,new Array(f.chartConfig.xAxis.categories.length)).map(function(){return[null,null]}),m}function u(a){"true"==g.threeD&&("pie"==a?(f.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},f.chartConfig.plotOptions.pie.depth=35,f.chartConfig.chart.marginTop=0):(f.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:15,viewDistance:25,depth:40},f.chartConfig.chart.marginTop=40,f.chartConfig.chart.spacingRight=60))}function v(a,b,c,e,j,k,l,m,n,o,p){if(null!=a){f.fields.push(a.field),0==f.chartConfig.series.length&&(G(),f.chartConfig.foo++,i(function(){H()},500)),D(a),c=null==c?a.display:c;var r=a.field,s=t(c,b,k,n,p);s.title=s.title||s.name,s.selected=o!==!1,s.query=e,angular.forEach(a.filters,function(b){if(!isNaN(b.count)){var c=h("actualValue")(b.val),g=h("displayValue")(b.val);null!=l&&("undefined"!=typeof g.indexOf?0==g.indexOf("<")?(g=g.substring(1),g=h("dateFormat")(g.trim(),l),g="&lt; "+g):0==g.indexOf(">")?(g=g.substring(1),g=h("dateFormat")(g.trim(),l),g="&gt; "+g):g=h("dateFormat")(g,l):g=h("dateFormat")(g,l));var i=!1;if(e){var k=d.convertHttpParamsToQuery(e);b.optional="value",i=d.queryContainsFilterForField(k,a.field,b)}var n={name:g,y:null==m||"count"==m?b.count:b.facts[m][0],selected:i,sliced:i,filter:[r,c,g,j]};if(I(f.actCategories,c)!=-1)null!=e&&(s.filters[I(f.actCategories,c)]=n.filter),s.data[I(f.actCategories,c)]=n;else if(f.chartConfig.xAxis.categories.push(g),f.actCategories.push(c),s.data.push(n),null!=e){var o=s.data.length>0?s.data.length-1:0;s.filters[o]=n.filter}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,q(s)}}function w(a,b,c,d,e,g,j,k,m,n,o,p){if(null!=a){0==f.chartConfig.series.length&&(G(),f.chartConfig.foo++,i(function(){H()},500)),f.timeSeriesFacets.indexOf(b)==-1&&f.timeSeriesFacets.push(b),0!=f.chartConfig.rangeSelector.enabled&&null!=g&&(f.chartConfig.rangeSelector.enabled=g),0!=f.chartConfig.navigator.enabled&&null!=j&&(f.chartConfig.navigator.enabled=j),null!=k&&(M=!0),c=null==c?l.get(a.display):c;var r={name:c,data:[],tooltip:e,type:d,showInNavigator:!0};r.selected=p!==!1,void 0!=n&&null!=n&&(r.marker=n);var s=[];angular.forEach(a.filters,function(a){if(!isNaN(a.count)){var b=h("actualValue")(a.val);void 0!=b&&"range"==b.type&&(b=b.from),s.push({act:b,count:null==m||"count"==m?a.count:a.facts[m][0]})}}),"true"!=o&&null!=o||(s=h("orderBy")(s,"act")),angular.forEach(s,function(a){r.data.push([new Date(a.act).valueOf(),a.count])}),q(r)}}function x(a,b,c,e,j,k,l,m,n,o,p,r,s){if(null!=a){f.fields.push(c),0==f.chartConfig.series.length&&(G(),f.chartConfig.foo++,i(function(){H()},500)),j=null==j?c:j;var u=t(j,e,n,o,s);u.title=u.title||u.name,u.selected=p;for(var v=0;v<a.length;v++){var w=a[v];null!=w.result&&(w=w.result);var x=null!=w.fields[b]?h("displayValue")(w.fields[b]):"",y=null!=w.fields[c]?h("actualValue")(w.fields[c]):"",z=null!=k&&null!=w.fields[k]?h("actualValue")(w.fields[k].val):null,A=null!=r&&null!=w.fields[r]?h("display")(w.fields[r].val):null;null!=A&&(A=h("formatAsCssName")(A)),y=""==y||isNaN(y)?null:parseFloat(y);var B=!1;if(l){var C=d.convertHttpParamsToQuery(l),D=angular.copy(w.fields[c]);D.optional="value",B=d.queryContainsFilterForField(C,D.field,D)}var E={name:x,y:y,className:A,selected:B,sliced:B,filter:[c,y,y,m]};if(f.chartConfig.xAxis.categories.indexOf(x)!=-1)u.data[f.chartConfig.xAxis.categories.indexOf(x)]=E,null!=z?u.urls[f.chartConfig.xAxis.categories.indexOf(x)]=z:null!=l&&(u.filters[f.chartConfig.xAxis.categories.indexOf(x)]=E.filter);else{f.chartConfig.xAxis.categories.push(x),u.data.push(E);var F;null!=z?(F=u.data.length>0?u.data.length-1:0,u.urls[F]=z):null!=l&&(F=u.data.length>0?u.data.length-1:0,u.filters[F]=E.filter)}}f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,q(u)}}function y(a){f.chartConfig.exporting=a}function z(a){f.chartConfig.credits=a}function A(a){f.chartConfig.legend=a}function B(a){f.chartConfig.tooltip=a}function C(a,b,c){if(g.hasOwnProperty("singleFilterMode")){var d={name:a,value:b,count:c};L.push(d),1===L.length?(f.singleFilterOverlay=!0,f.overlayFacet=L[0].name,f.overlayValue=L[0].value,f.overlayCount=L[0].count):f.singleFilterOverlay=!1}}function D(a){if(a&&a.filters&&g.hasOwnProperty("singleFilterMode")&&f.response&&f.response.query&&f.response.query.filters)for(var b=0;b<f.response.query.filters.length;b++)if(a.field==f.response.query.filters[b].field)for(var c=0;c<a.filters.length;c++)h("actual")(f.response.query.filters[b].val)==h("actual")(a.filters[c].val)&&a.filters[c].count==a["sum-of-counts"]&&C(a.field,h("display")(a.filters[c].val),a.filters[c].count)}function E(a){if(null!=g.query){var b=d.getQueryAsHttpParams(g.query,a);if(null!=b)return b}}function F(){return g.response}function G(){f.loading<=0&&i(function(){f.chartConfig.getChartObj().showLoading()},0),f.loading++}function H(){f.loading--,f.loading<=0&&i(function(){f.chartConfig.getChartObj().hideLoading()},0)}function I(a,b){if(angular.isObject(b)){var c=h("filter")(a,b,!0)[0];return a.indexOf(c)}return a.indexOf(b)}function J(){return g}function K(){return f.results||null}var L=[],M=!1;f.timeSeriesFacets=[],f.actCategories=[],f.loading=0,f.allSeries=[],f.unselectedSeries=[],f.fields=[],null!=g.innerSize&&"true"==g.showValue&&(angular.element(k).on("resize",n),f.$on("$destroy",m));var N=this;N.addFacetSeries=v,N.addTimeSeries=w,N.addResultListSeries=x,N.addExportingOptions=y,N.addCreditOptions=z,N.addLegendOptions=A,N.addTooltipOptions=B,N.addSeries=r,N.addPlatformTimeSeries=s,N.getQuery=E,N.getResponse=F,N.setLoading=G,N.unsetLoading=H,N.getChartAttributes=J,N.getResultsAttribute=K,f.type=null==g.type?"pie":g.type,g.maxCharacters=null==g.maxCharacters?"250":g.maxCharacters,g.height=null==g.height?"400":g.height,f.removeFilterFromUrl=function(b){a.removeFiltersFromUrl(b,!0)},f.toggleSeries=function(a){if(f.chartConfig&&f.chartConfig.series){for(var b,c=!1,d=0;d<f.chartConfig.series.length;d++)a.id==f.chartConfig.series[d].id&&(c=!0,b=d);c?(f.chartConfig.series.splice(b,1),f.unselectedSeries.push(a.tkid)):(f.chartConfig.series.push(a),f.unselectedSeries.splice(f.unselectedSeries.indexOf(a.tkId),1))}},f.seriesIsSelected=function(a){for(var b=!1,c=0;c<f.chartConfig.series.length;c++)a.id==f.chartConfig.series[c].id&&(b=!0);return b},f.applyFilters=function(){var b=f.chartConfig.getChartObj().getSelectedPoints();f.showApplyFilters=!1;var c;for(c=0;c<f.fields.length;c++)a.removeFiltersFromUrl(f.fields[c],!1);for(c=0;c<b.length;c++){var d=b[c].options.filter;a.addFilterToUrl(d[0],d[1],d[2],!1,"value")}a.reloadSearch()},void 0==f.chartConfig&&(f.chartConfig={foo:1,chart:{height:g.height},exporting:{enabled:!1},plotOptions:{pie:{dataLabels:{enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.key);if(c!=-1){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&f.chartConfig.series[f.i].data[c].y&&(b+=f.chartConfig.series[f.i].data[c].y);if(g.maxLabels!=-1||f.labelCounter%f.showInterval==0)return a>0&&this.key.length>a?this.key.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.key+("true"==g.showCount?" ("+b+")":"")}},style:{}}}},rangeSelector:{enabled:!1},navigator:{enabled:!1},series:[],xAxis:{title:{text:f.xtitle},events:{afterSetExtremes:function(b){"time"==g.type&&1==M&&"zoom"==b.trigger&&(angular.forEach(f.timeSeriesFacets,function(b){a.removeFiltersFromUrl(b,!1)}),angular.forEach(f.timeSeriesFacets,function(c,d){var e=new Date(b.userMin).toISOString(),g=new Date(b.userMax).toISOString(),h=e.substring(0,e.length-5),i=g.substring(0,g.length-5);a.addRangeFilterToUrl(c,h,i,e,g,d==f.timeSeriesFacets.length-1,!1,"-")}))}}},credits:{enabled:!1},yAxis:{title:{text:f.ytitle}},title:{text:g.title},subtitle:{text:g.subtitle},func:function(a){if(i(function(){if(null!=a&&null!=a.hasRendered){if(null!=g.innerSize&&"true"==g.showValue){f.seriesCopy=a.series[0];var b=a.series[0];if(null!=b){var c=a.renderer,d=a.plotLeft+b.center[0],e=a.plotTop+b.center[1],i=null;angular.forEach(b.points,function(a){null==i?i=a:i.y<a.y&&(i=a)});var j="";j=i.name.length>=56?"6px":i.name.length>=35?"8px":i.name.length>=30?"10px":i.name.length>=25?"12px":i.name.length>=20?"14px":i.name.length>=16?"18px":i.name.length>=12?"20px":"26px",i.slice(!0),c.text(i.name,d,e).attr({"text-anchor":"middle","font-size":j,"font-weight":"800",id:"field-name"}).add(),c.text(h("numberFormat")(i.y,"formatted"),d,e+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add()}}p()}},0),g.websocket){var b=c(g.websocket);b.onMessage(function(b){var c=JSON.parse(b.data);a.series[0].addPoint({y:c.count,name:c.val.dsp})})}}},"time"==g.type?(f.chartConfig.chartType="stock",f.chartConfig.chart.zoomType="x",f.chartConfig.rangeSelector.enabled=!0,f.chartConfig.navigator.enabled=!0,f.chartConfig.xAxis.labels={rotation:parseInt(g.xlabelRotation)||0,enabled:"false"!=g.showLabels},f.chartConfig.tooltip={xDateFormat:"%A, %b %d, %Y, %H:%M"}):f.chartConfig.xAxis.categories=[],"radar"==g.radarOrPolar?(f.chartConfig.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="polygon",f.chartConfig.yAxis.lineWidth=0,f.chartConfig.xAxis.lineWidth=0,f.chartConfig.xAxis.tickmarkPlacement="on",j.addClass("radar-chart")):"polar"==g.radarOrPolar?(f.chartConfig.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="circle",f.chartConfig.yAxis.lineWidth=1,f.chartConfig.xAxis.lineWidth=1,f.chartConfig.xAxis.tickmarkPlacement="on"):"time"!=g.type&&(f.chartConfig.xAxis.labels={rotation:parseInt(g.xlabelRotation)||0,enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.value);if(c!=-1){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&(b+=f.chartConfig.series[f.i].data[c][1]);if(g.maxLabels!=-1||f.labelCounter%f.showInterval==0)return a>0&&this.value.length>a?this.value.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.value+("true"==g.showCount?" ("+b+")":"")}}}),null!=g.innerSize&&(f.chartConfig.plotOptions.pie.innerSize=g.innerSize),"false"==g.showTooltips&&(f.chartConfig.tooltip={enabled:!1}),"true"!=g.invertAxes&&"bar"!=g.type||(f.chartConfig.chart.inverted=!0),null!=f.options&&angular.extend(f.chartConfig,f.options)),null!=g.response?(f.response=e.getResponse(g.response),null!=f.response&&(o(),f.response.facets&&null!=f.response.facets[g.facetName]&&v(f.response.facets[g.facetName],f.type,g.facetName,f.query)),f.$on(g.response+"_updated",function(){o(),f.response=e.getResponse(g.response),f.response.facets&&null!=f.response.facets[g.facetName]&&N.addFacetSeries(f.response.facets[g.facetName],f.type,g.facetName,f.query)})):f.$on("reloadSearch",function(){o()});var O=f.$watch(function(){var a=j[0].getBoundingClientRect();a.bottom>0&&(p(),O())});f.$on("reflow_highcharts",function(){p()})}],template:function(a,b){var c="";return b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-mode-wrapper">'),b.hasOwnProperty("response")?(c+='<div class="tk-stl-chart-display" ng-if="response != null">',"true"==b.selectSeries&&(c+='<div class="tk-stl-series-select" ng-if="allSeries.length > 1"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{name: seriesSearch}">{{ series.name }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>')):(c+='<div class="tk-stl-chart-display">',"true"==b.selectSeries&&(c+='<div class="tk-stl-series-select"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{title: seriesSearch}">{{ series.title }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>')),c+='<div ng-transclude></div><highchart config="chartConfig" class="chart-display '+("true"==b.threeD?"three-d-chart":"")+'"></highchart>',c+='<button ng-show="showApplyFilters" ng-click="applyFilters()" class="tk-stl-button tk-stl-button-small ng-hide apply-chart-filters">Apply Filters</button></div>',b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-overlay clickable" ng-if="singleFilterOverlay" ng-click="removeFilterFromUrl(overlayFacet)"><span class="removeFilter">&times;</span><h4>{{ overlayFacet }}</h4><h2>{{ overlayValue }}</h2><h3>{{ overlayCount }}</h3></div></div>'),c}};return f}angular.module("lightning").directive("chartDisplay",a),a.$inject=["$lightningUrl","$location","$websocket","QueryService","ResponseService"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge","?^^graphFlow"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h={enabled:!0,filename:c.fileName,url:null==c.url?"http://export.highcharts.com":c.url,chartOptions:{chart:{backgroundColor:"white"}}};null!=e?e.addExportingOptions(h):null!=f?f.addExportingOptions(h):null!=g&&g.addExportingOptions(h)}}};return a}angular.module("lightning").directive("chartExport",a)}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:"^^chartDisplay",link:{pre:function(a,b,c,d){var e={enabled:!0,title:{text:c.title},x:parseInt(c.x)||0,y:parseInt(c.y)||0,margin:40};null!=c.align&&(e.align=c.align),null!=c.verticalAlign&&(e.verticalAlign=c.verticalAlign),null!=c.layout&&(e.layout=c.layout),d.addLegendOptions(e)}}};return a}angular.module("lightning").directive("chartLegend",a)}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^seriesFacet","?^^seriesResultList"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h={shared:"true"===c.shared};null!=c.headerFormat&&(h.headerFormat=c.headerFormat),null!=c.pointFormat&&(h.pointFormat=c.pointFormat),null!=g?g.addTooltipOptions(h):null!=f?f.addTooltipOptions(h):e.addTooltipOptions(h)}}};return a}angular.module("lightning").directive("chartTooltip",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g={restrict:"E",transclude:!0,scope:{data:"=",options:"=",title:"@",subtitle:"@",seriesName:"@",inverted:"@"},controller:["$scope","$attrs","$element",function(g,h,i){function j(){g.chartConfig&&"function"==typeof g.chartConfig.getChartObj&&f(function(){g.chartConfig.getChartObj().reflow()},0)}function k(){a.getGraphFacet(h.query,h.platform,h.sourceField,h.targetField,h.measure,h.measureField).then(function(a){for(var b=a.data.edges||[],c=[],d=0;d<b.length;d++){var f=b[d];c.push([f.s,f.t,f.w])}g.chartConfig.series[0].data=c,g.chartConfig.series[0].events={click:function(a){e.removeFiltersFromUrl(h.sourceField,!1),e.removeFiltersFromUrl(h.targetField,!1),a.point.from&&a.point.to?(e.addFilterToUrl(h.sourceField,a.point.from,a.point.from,!1),e.addFilterToUrl(h.targetField,a.point.to,a.point.to,!1)):0==a.point.linksTo.length?e.addFilterToUrl(h.sourceField,a.point.name,a.point.name,!1):0==a.point.linksFrom.length&&e.addFilterToUrl(h.targetField,a.point.name,a.point.name,!1),e.reloadSearch()}},g.chartConfig=angular.copy(g.chartConfig)},function(a){b.error("Graph:Flow","Error retrieving facet graph from platform - "+a.status+" - "+a.statusText)})}function l(a){g.chartConfig.exporting=a}function m(a){g.chartConfig.credits=a}var n=this;if(g.inverted="true"==g.inverted||1==g.inverted,g.chartConfig={chart:{inverted:g.inverted},title:{text:g.title},subtitle:{text:g.subtitle},exporting:{enabled:!1},credits:{enabled:!1},series:[{keys:["from","to","weight"],type:"sankey",id:"sankey-1",name:g.seriesName||" "}]},h.platform&&h.sourceField&&h.targetField){var o=d.getQuery(h.query),p=c.getPlatform(h.platform);p&&o&&k(),g.$on("query_"+h.query+"_updated",function(){k()})}else g.chartConfig.series[0].data=g.data;null!=g.options&&angular.extend(g.chartConfig,g.options);var q=g.$watch(function(){var a=i[0].getBoundingClientRect();a.bottom>0&&(j(),q())});n.addExportingOptions=l,n.addCreditOptions=m}],template:function(){return'<div class="sankey-chart"><ng-transclude></ng-transclude><highchart config="chartConfig"></highchart></div>'}};return g}angular.module("lightning").directive("graphFlow",a),a.$inject=["$twigkit","$lightningLog","PlatformService","QueryService","$lightningUrl","$timeout"]}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",transclude:!0,scope:{},link:function(f,g,h){function i(){var a=j.facets[h.facetName],g=null==h.key?"hc-key":h.key,i=null==h.title?"":h.title,k=null==h.subtitle?"":h.subtitle;if(null==a)return void(f.show=!1);f.show=!0;var l=h.seriesName||a.display||h.facetName;if(null==Highcharts.maps[h.map])return c.error("Chart:Highmaps","Map named - "+h.map+' - could not be found, please make sure the script tag for the map is included. eg <script src="//code.highcharts.com/mapdata/countries/gb/gb-all.js"></script>. Maps can be found at - http://code.highcharts.com/mapdata/'),void(f.show=!1);var m=[];angular.forEach(a.filters,function(a){var c={value:a.count,filter:a};c[g]=b("actual")(a.val),m.push(c)}),f.config={plotOptions:{map:{mapData:Highcharts.maps[h.map],joinBy:[g]}},mapNavigation:{enabled:!0,buttonOptions:{verticalAlign:"bottom"}},colorAxis:{min:0},chartType:"map",title:{text:i},subtitle:{text:k},series:[{data:m,mapData:Highcharts.maps[h.map],joinBy:[g],states:{hover:{color:"black"}},events:{click:function(a){if(null!=h.query){var b=d.getQueryAsHttpParams(h.query,!0);null!=b&&e.setUrlParameters(b,!1),e.addFilterObjectToUrl(a.point.options.filter,!0)}}},name:l,showInLegend:!0},{name:"Separators",type:"mapline",data:Highcharts.geojson(Highcharts.maps[h.map],"mapline"),color:"silver",showInLegend:!1,enableMouseTracking:!1}]}}var j=a.getResponse(h.response,"facets");null!=j?i():f.show=!1,f.$on(h.response+"_updated",function(){j=a.getResponse(h.response,"facets"),i()})},template:function(){var a="<div>";return a+='<highchart config="config" ng-if="show" style="height:700px;"></highchart>',a+="</div>"}};return f}angular.module("lightning").directive("geoHighmaps",a),a.$inject=["ResponseService","$filter","$lightningLog","QueryService","$lightningUrl"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?e.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){h.measure=null==h.measure?"count":h.measure,h.query=l(!0),k.setLoading();var a=parseInt(j.numberToShow)?parseInt(j.numberToShow):10,b=l(!1);c.searchSeriesFacet(b,o,j.name,h.measure,a).then(function(a){var b={name:j.name,labelField:"value",valueField:h.measure,type:j.type,title:j.title,action:j.action,dateFormat:j.dateFormat,measure:h.measure,query:h.query,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,selected:"false"!=j.selectedByDefault,select:j.select};k.addSeries(a.data,b)},function(a){f.error("Series:Facet","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}function n(b){var c=angular.copy(b.facets[j.name]);h.query=l(!0),parseInt(j.numberToShow)&&null!=c&&(c.filters=a("limitTo")(c.filters,j.numberToShow));var d=null;"false"!=j.showMarker&&"true"!=j.showMarker||(d={enabled:"true"==j.showMarker});var e="false"!=j.selectedByDefault;k.addFacetSeries(c,j.type,j.title,h.query,j.action,h.tooltipOptions,j.dateFormat,h.measure,d,e,j.select)}h.addFacetSeries=n;var o,p;if(null!=j.platform)o=b.getPlatform(j.platform),m(),h.$on("reloadSearch",function(){d(function(){m()},0)});else if(null==j.response){var q=k.getResponse();p=g.getResponse(q,"facets"),null!=p&&h.addFacetSeries(p),h.$on(q+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}else p=g.getResponse(j.response,"facets"),null!=p&&h.addFacetSeries(p),h.$on(j.response+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesFacet",a),a.$inject=["$filter","PlatformService","$twigkit","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@"},transclude:!0,require:"^^chartDisplay",link:{post:function(b,c,f,h){function i(){null!=l&&b.addPivotFacetSeries(l),b.$on(f.response+"_updated",function(a,c){null!=c&&d(function(){b.addPivotFacetSeries(c)},0)})}function j(a){return null!=f.query?e.getQueryAsHttpParams(f.query,a):h.getQuery(a)}function k(c){var d=angular.copy(c.facets[f.name]);b.query=j(!0);var e=null;"false"!=f.showMarker&&"true"!=f.showMarker||(e={enabled:"true"==f.showMarker});for(var g={},i=0;i<d.filters.length;i++)for(var k=d.filters[i],l=a("display")(k.val),m=0;m<k.rel.length;m++){var n=k.rel[m];if(0!=n.count){var o=a("display")(n.val);g[o]||(g[n.val]={options:{field:n.field,name:o,title:o,labelField:"value",valueField:"count",type:f.type,query:b.query,select:f.select,showMarker:f.showMarker,tooltipOptions:null,action:f.action,selected:!0,dataType:"pivot-facet"},data:{header:["value","count"],series:[]}}),g[o].data.series.push([l,n.count])}}for(var p in g)h.addSeries(g[p].data,g[p].options)}b.addPivotFacetSeries=k;var l;if(null==f.response){var m=h.getResponse();l=g.getResponse(m,"facets"),i()}else l=g.getResponse(f.response,"facets"),i()}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesPivot",a),a.$inject=["$filter","PlatformService","$twigkit","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{results:"=?",valueField:"@",labelField:"@",classField:"@",title:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?e.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){h.query=l(!0),k.setLoading();var a=[];a.push(h.labelField),a.push(h.valueField),null!=j.urlField&&a.push(j.urlField),null!=h.classField&&a.push(h.classField);var c=parseInt(j.numberToShow)?parseInt(j.numberToShow):10,e=l(!1);b.searchSeriesFields(e,n,a.join(","),c).then(function(a){var b={name:h.valueField,labelField:h.labelField,valueField:h.valueField,type:j.type,title:h.title,action:j.action,urlField:j.urlField,query:h.query,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,selected:"false"!=j.selectedByDefault,classField:h.classField,select:j.select,
dataType:"result-list"};d(function(){k.addSeries(a.data,b)},0)},function(a){f.error("Series:ResultList","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}h.addResultListSeries=function(b){var c=angular.copy(b.results);h.query=l(!0),parseInt(j.numberToShow)&&(c=a("limitTo")(c,j.numberToShow));var d=null;"false"!=j.showMarker&&"true"!=j.showMarker||(d={enabled:"true"==j.showMarker});var e="false"!=j.selectedByDefault;k.addResultListSeries(c,h.labelField,h.valueField,j.type,h.title,j.urlField,h.query,j.action,h.tooltipOptions,d,e,h.classField,j.select)};var n,o,p=k.getChartAttributes();if(null!=j.platform)n=c.getPlatform(j.platform),d(function(){m()},0),h.$on("reloadSearch",function(){d(function(){m()},0)});else if(null==j.response&&null!=j.results)h.$watch("results",function(a){a&&h.addResultListSeries({results:a})});else if(null==j.response&&null!=p.results)h.$watch(k.getResultsAttribute,function(a){a&&h.addResultListSeries({results:a})});else if(null==j.response){var q=k.getResponse();o=g.getResponse(q),null!=o&&h.addResultListSeries(o),h.$on(q+"_updated",function(a,b){null!=b&&d(function(){h.addResultListSeries(b)},0)})}else o=g.getResponse(j.response),null!=o&&h.addResultListSeries(o),h.$on(j.response+"_updated",function(a,b){null!=b&&d(function(){h.addResultListSeries(b)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesResultList",a),a.$inject=["$filter","$twigkit","PlatformService","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@",valueField:"@",labelField:"@",title:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?d.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){return{name:j.name||h.labelField,labelField:null!=h.labelField?h.labelField:"value",valueField:null!=h.valueField?h.valueField:h.measure,type:h.type,title:j.title,query:null!=j.query||null!=h.query?h.query:null,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,rangeSelector:"false"!=j.rangeSelector,navigator:"false"!=j.navigator,sort:j.sort,selected:"false"!=j.selectedByDefault}}function n(){h.measure=null==h.measure?"count":h.measure,h.query=l(!0),k.setLoading();var a=parseInt(j.numberToShow)?parseInt(j.numberToShow):25,b=l(!1);if(null!=h.labelField&&null!=h.valueField){var d=[];d.push(h.labelField),d.push(h.valueField),null!=j.urlField&&d.push(j.urlField),c.searchSeriesFields(b,p,d.join(","),a).then(function(a){var b=m();k.addPlatformTimeSeries(a.data,b)},function(a){e.error("Series:Time","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}else c.searchSeriesFacet(b,p,j.name,h.measure,a).then(function(a){var b=m();k.addPlatformTimeSeries(a.data,b)},function(a){e.error("Series:Time","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}function o(a){if(h.query=l(!0),null!=j.name){var b=angular.copy(a.facets[j.name]),c="false"!=j.rangeSelector,d="false"!=j.navigator,e="false"!=j.selectedByDefault,g=null;"false"!=j.showMarker&&"true"!=j.showMarker||(g={enabled:"true"==j.showMarker}),k.addTimeSeries(b,j.name,j.title,h.type,h.tooltipOptions,c,d,h.query,h.measure,g,j.sort,e)}else if(null!=h.valueField&&null!=h.labelField){var i=m();i.name=h.labelField;for(var n={header:[h.labelField,h.valueField],series:[]},o=0;o<a.results.length;o++){var p=f("result")(a,o);if(null!=p.fields[h.labelField]&&null!=p.fields[h.valueField]){var q=[];q.push({act:f("actual")(p.fields[h.labelField]),dsp:f("display")(p.fields[h.labelField])}),q.push(f("actual")(p.fields[h.valueField])),n.series.push(q)}}k.addPlatformTimeSeries(n,i)}}h.type=null==j.type?"spline":j.type;var p,q;if(null!=j.platform)p=a.getPlatform(j.platform),n(),h.$on("reloadSearch",function(){b(function(){n()},0)});else if(null==j.response){var r=k.getResponse();q=g.getResponse(r),null!=q&&o(q),h.$on(r+"_updated",function(a,c){null!=c&&b(function(){o(c)},0)})}else q=g.getResponse(j.response),null!=q&&o(q),h.$on(j.response+"_updated",function(a,c){null!=c&&b(function(){o(c)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesTime",a),a.$inject=["PlatformService","$timeout","$twigkit","QueryService","$lightningLog","$filter","ResponseService"]}();